# Llama-3.3-70B SAE Inspect

ç”¨ Sparse Autoencoder è§£ç  Llama-3.3-70B-Instruct çš„ Layer 50 æ¿€æ´»ï¼Œåˆ†æä¸åŒæç¤ºè¯é£æ ¼çš„ç¥ç»æœºåˆ¶å·®å¼‚ã€‚

## å¿«é€Ÿå¼€å§‹

### 0. è¿è¡Œç¯å¢ƒ

æ‰€æœ‰å®éªŒåœ¨ Docker å®¹å™¨ä¸­è¿è¡Œï¼š

```bash
# å¯åŠ¨å¹¶è¿›å…¥å®¹å™¨
docker start pink-ai && docker exec -it pink-ai bash

# å®éªŒç›®å½•
cd /workspace/doc-share/arxiv/paper15/exp/SAE-llama/
```

### 0b. ä¸‹è½½ SAE æ¨¡å‹

```bash
# ä½¿ç”¨ä¸­å›½é•œåƒï¼ˆæ¨èï¼‰
pip install huggingface_hub
HF_ENDPOINT=https://hf-mirror.com huggingface-cli download \
    Goodfire/Llama-3.3-70B-Instruct-SAE-l50 \
    --local-dir /path/to/models/Llama-3.3-70B-Instruct-SAE-l50

# æˆ–ä½¿ç”¨å®˜æ–¹æºï¼ˆéœ€è¦æ¢¯å­ï¼‰
# huggingface-cli download Goodfire/Llama-3.3-70B-Instruct-SAE-l50 --local-dir ...
```

**æ¨¡å‹å¤§å°ï¼š** 4.0 GB

**SAE ç»“æ„ï¼š**
```
encoder_linear.weight: [65536, 8192]  # ç¼–ç å™¨
encoder_linear.bias:   [65536]
decoder_linear.weight: [8192, 65536]  # è§£ç å™¨
decoder_linear.bias:   [8192]
```

### 1. æå–æ¿€æ´»

```bash
python step1_extract_activations.py
```

è¾“å‡ºï¼š`activations_layer50.pt`

### 2. SAE è§£ç 

```bash
python step2_sae_decode.py
```

è¾“å‡ºï¼š`features_layer50.pt`

### 3. å·®å¼‚åˆ†æ

```bash
python step3_diff_analysis.py
```

è¾“å‡ºï¼š`feature_diff.json`

### 4. ç‰¹å¾è¯­ä¹‰åˆ†æ

```bash
python step4b_feature_context.py
```

è¾“å‡ºï¼š`feature_context.json`

### 5. AutoInterp åˆ†æ

```bash
python step5_autointerp.py
```

è¾“å‡ºï¼š`autointerp_results.json`ï¼ˆ6 æ¡ä»¶ Ã— 50 ä¸»é¢˜ = 300 æ ·æœ¬çš„æ¿€æ´»åˆ†å¸ƒï¼‰

### 6. UMAP å¯è§†åŒ–

```bash
python step6_umap.py
```

è¾“å‡ºï¼š
- `umap_activations.png`ï¼ˆåŸå§‹ 8192 ç»´æ¿€æ´»çš„ UMAPï¼‰
- `umap_features.png`ï¼ˆSAE 65536 ç»´ç¨€ç–ç‰¹å¾çš„ UMAPï¼‰

---

## èƒŒæ™¯ï¼šä»€ä¹ˆæ˜¯ SAEï¼Ÿ

SAE (Sparse Autoencoder) æŠŠæŸä¸€å±‚çš„æ¿€æ´»å‘é‡"è§£å‹"æˆç¨€ç–è¡¨ç¤ºï¼š

```
è¾“å…¥: hidden_state [8192]  (Llama-70B çš„ d_model)
   â†“
Encoder: [8192 â†’ 65536]  (ç¨€ç–å±•å¼€)
   â†“
ReLU: å¤§éƒ¨åˆ†å˜æˆ 0ï¼Œåªæœ‰å‡ ç™¾ä¸ª feature è¢«æ¿€æ´»
   â†“
Decoder: [65536 â†’ 8192]  (é‡å»ºåŸå§‹æ¿€æ´»)
```

**æ ¸å¿ƒæ€æƒ³ï¼š**
- 8192 ç»´å‹ç¼©è¡¨ç¤º â†’ 65536 ç»´ç¨€ç–è¡¨ç¤º
- æ¯ä¸ª feature å¯¹åº”ä¸€ä¸ªå¯è§£é‡Šçš„æ¦‚å¿µ
- åªæœ‰å°‘æ•° feature è¢«æ¿€æ´» â†’ "ç¨€ç–"

**ç»å…¸æ¡ˆä¾‹ï¼š** Anthropic ç”¨ SAE æ‰¾åˆ°äº†"é‡‘é—¨å¤§æ¡¥"çš„ featureï¼Œæ”¾å¤§åæ¨¡å‹ç–¯ç‹‚è¾“å‡ºé‡‘é—¨å¤§æ¡¥ã€‚

---

## å®éªŒç›®æ ‡

åˆ†æå…­ç§æç¤ºè¯é£æ ¼çš„ç¥ç»æœºåˆ¶å·®å¼‚ï¼š

| é£æ ¼ | è¯´æ˜ |
|------|------|
| standard | åŸºå‡†ï¼šç›´æ¥æé—® |
| padding | åŠ åºŸè¯å¡«å…… |
| spaces | åŠ ç©ºæ ¼å¡«å…… |
| novice | "explain to a novice" |
| expert | "explain to an expert" |
| guru | åŠ å¤§ç¥åå­— |

**æ ¸å¿ƒé—®é¢˜ï¼š** ä¸ºä»€ä¹ˆ Novice EID > Expert EIDï¼Ÿ

---

## å®éªŒç»“æœ

### 1. æ¿€æ´»æ•°é‡ç»Ÿè®¡ï¼ˆé¦–ä¸ªæ ·æœ¬ï¼‰

| é£æ ¼ | æ¿€æ´» feature æ•° | max æ¿€æ´»å€¼ |
|------|----------------|-----------|
| **novice** | **137** | 4.71 |
| standard | 131 | 4.11 |
| padding | 126 | 6.11 |
| guru | 115 | 4.39 |
| **expert** | **114** | 5.31 |
| spaces | 99 | 4.80 |

**å‘ç°ï¼šNovice æ¿€æ´»çš„ feature æ•°é‡æœ€å¤šï¼ŒExpert æœ€å°‘ã€‚**

### 2. Novice vs Expert å·®å¼‚åˆ†æï¼ˆ50 æ ·æœ¬ï¼‰

| æŒ‡æ ‡ | Novice | Expert | å·®å¼‚ |
|------|--------|--------|------|
| å¹³å‡æ¿€æ´»æ•° | **132.4** | 113.1 | +17% |
| ç‹¬å  features | **369** | 208 | +77% |
| å¹³å‡æ¿€æ´»å¼ºåº¦ | 0.274 | 0.279 | â‰ˆ |

### 3. å®Œç¾åˆ†ç¦»çš„ Features

**100% Noviceï¼Œ0% Expertï¼ˆæ•™å­¦æ¨¡å¼ç­¾åï¼‰ï¼š**

| Feature ID | Novice é¢‘ç‡ | Expert é¢‘ç‡ |
|------------|------------|------------|
| 34942 | 100% | 0% |
| 55982 | 100% | 0% |
| 17913 | 100% | 0% |
| 59519 | 100% | 0% |

**100% Expertï¼Œ0% Noviceï¼ˆä¸“ä¸šæ¨¡å¼ç­¾åï¼‰ï¼š**

| Feature ID | Novice é¢‘ç‡ | Expert é¢‘ç‡ |
|------------|------------|------------|
| 51630 | 0% | 100% |
| 35870 | 0% | 100% |
| 5936 | 0% | 100% |
| 21604 | 0% | 100% |
| 53369 | 0% | 100% |
| 46703 | 0% | 100% |

### 4. AutoInterp ç‰¹å¾è¯­ä¹‰åˆ†æï¼ˆDay 2 æ–°å¢ï¼‰

ç”¨ AutoInterp æ–¹æ³•åˆ†æè¿™ 10 ä¸ªç‰¹å¾åœ¨**æ‰€æœ‰ 6 ç§æ¡ä»¶**ï¼ˆ300 æ ·æœ¬ï¼‰ä¸­çš„æ¿€æ´»æ¨¡å¼ï¼š

**Novice ç‰¹å¾ï¼ˆæ¡ä»¶åˆ†å¸ƒï¼‰ï¼š**

| Feature ID | æ€»æ¿€æ´» | æ¡ä»¶åˆ†å¸ƒ | è¯­ä¹‰æ¨æ–­ |
|------------|--------|----------|----------|
| 34942 | 56 | novice:50, standard:4, spaces:2 | ã€Œæ–°æ‰‹è§£é‡Šã€ä¿¡å· |
| 59519 | 76 | novice:50, padding:10, spaces:11, std:5 | ã€Œè§£é‡Šè¯·æ±‚ã€ä¿¡å· |
| 17913 | 56 | novice:50, padding:6 | ã€Œæ–°æ‰‹ã€ä¸“å±ä¿¡å·ï¼ˆæœ€çº¯å‡€ï¼‰ |
| 55982 | 63 | novice:50, padding:9, standard:4 | ã€Œæ–°æ‰‹è§£é‡Šã€ä¿¡å· |

**Expert ç‰¹å¾ï¼ˆæ¡ä»¶åˆ†å¸ƒï¼‰ï¼š**

| Feature ID | æ€»æ¿€æ´» | æ¡ä»¶åˆ†å¸ƒ | è¯­ä¹‰æ¨æ–­ |
|------------|--------|----------|----------|
| 35870 | 52 | expert:50, guru:2 | ã€Œexpert èº«ä»½ã€ä¸“å±ä¿¡å·ï¼ˆæœ€çº¯å‡€ï¼‰ |
| 51630 | 63 | expert:50, guru:13 | ã€Œexpertã€ä¸ºä¸» |
| 46703 | 168 | expert:50, guru:49, spaces:35, pad:17... | ã€Œæ·±åº¦åˆ†æã€ä¿¡å· |
| 21604 | 152 | expert:50, guru:47, **padding:50**, ... | ã€Œè®¤çœŸå›ç­”ã€ä¿¡å· |
| 5936 | 147 | expert:50, **guru:50**, padding:44, ... | ã€Œå¤§ç¥è§†è§’ã€ä¿¡å· |
| 53369 | 114 | expert:50, padding:37, standard:21, **guru:0** | ã€ŒæŠ€æœ¯åˆ†æã€ä¿¡å· |

**å…³é”®å‘ç°ï¼š**

1. **Feature 35870 æ˜¯æœ€çº¯å‡€çš„ expert ä¿¡å·**â€”â€”50/50 å…¨ä¸­ï¼Œåªæœ‰ 2 ä¸ª guru æ³„æ¼
2. **Feature 21604 è¢« padding ä¹Ÿè§¦å‘äº† 50 æ¬¡**â€”â€”å®ƒå“åº”çš„æ˜¯ã€Œè®¤çœŸå›ç­”ã€ï¼Œä¸æ˜¯ã€Œexpert èº«ä»½ã€
3. **Feature 5936 è¢« guru å®Œå…¨è§¦å‘**â€”â€”å®ƒå“åº”çš„æ˜¯ã€Œæ·±åº¦åˆ†æã€è¦æ±‚
4. **Feature 53369 ä¸è¢« guru è§¦å‘**â€”â€”å®ƒå“åº”çš„æ˜¯ã€ŒæŠ€æœ¯åˆ†æã€è€Œéã€Œè§’è‰²æ‰®æ¼”ã€

**ç»“è®ºï¼šè¿™ 10 ä¸ªç‰¹å¾ä¸æ˜¯ç®€å•çš„ã€ŒNovice å¼€å…³ã€å’Œã€ŒExpert å¼€å…³ã€ï¼Œè€Œæ˜¯ä¸€ç»„è¯­ä¹‰ç»†åˆ†çš„ç‰¹å¾ã€‚**

### 5. å…³é”®æ´è§

1. **Novice æ¿€æ´»æ›´å¤š features**ï¼šå¹³å‡ 132 vs 113ï¼Œå¤š 17%
2. **Novice ç‹¬å  features æ›´å¤š**ï¼š369 vs 208ï¼Œå¤š 77%
3. **å­˜åœ¨å®Œç¾åˆ†ç¦»çš„ç¥ç»ç­¾å**ï¼šæŸäº› feature åªåœ¨ä¸€ç§æ¨¡å¼ä¸‹æ¿€æ´»
4. **æ¿€æ´»å¼ºåº¦ç›¸è¿‘**ï¼šå·®å¼‚ä¸»è¦åœ¨"æ¿€æ´»äº†ä»€ä¹ˆ"ï¼Œè€Œé"æ¿€æ´»å¤šå¼º"
5. **100% æ¿€æ´»ç‡è¯æ˜æç¤ºè¯é©±åŠ¨**ï¼šè¿™äº›å¼€å…³ä¸ä¸»é¢˜æ— å…³ï¼Œçº¯ç²¹ç”±æç¤ºè¯è§¦å‘

**è§£é‡Šï¼š**"ç»™æ–°æ‰‹è§£é‡Š"éœ€è¦æ¿€æ´»æ›´å¤šè¯­ä¹‰å•å…ƒï¼ˆç±»æ¯”ã€ä¾‹å­ã€èƒŒæ™¯çŸ¥è¯†ï¼‰ï¼Œè€Œ"ç»™ä¸“å®¶è§£é‡Š"å¯ä»¥è·³è¿‡è¿™äº›ï¼Œç›´æ¥ç”¨æœ¯è¯­ã€‚è¿™å°±æ˜¯ Novice EID > Expert EID çš„ç¥ç»æœºåˆ¶åŸºç¡€ã€‚

**"æ¨¡å¼å¼€å…³"å‡è¯´ï¼š** å¤§è¯­è¨€æ¨¡å‹å†…éƒ¨å­˜åœ¨ä¸“é—¨çš„æ¨¡å¼åˆ‡æ¢ç‰¹å¾ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„äº¤æµæƒ…å¢ƒã€‚è¿™äº›ç‰¹å¾åœ¨æç¤ºè¯è§£æé˜¶æ®µè¢«æ¿€æ´»ï¼Œå¹¶æŒç»­å½±å“åç»­çš„ç”Ÿæˆè¿‡ç¨‹ã€‚

### 6. UMAP å¯è§†åŒ–ï¼ˆDay 3 æ–°å¢ï¼‰

æŠŠ 300 ä¸ªæ ·æœ¬ï¼ˆ6 æ¡ä»¶ Ã— 50 ä¸»é¢˜ï¼‰æŠ•å½±åˆ° 2Dï¼Œè§‚å¯Ÿè¯­ä¹‰ç©ºé—´åˆ†å¸ƒã€‚

**åŸå§‹æ¿€æ´» UMAPï¼ˆ8192 ç»´ï¼‰ï¼š**

![umap_activations](umap_activations.png)

**SAE ç‰¹å¾ UMAPï¼ˆ65536 ç»´ç¨€ç–ï¼‰ï¼š**

![umap_features](umap_features.png)

**å…³é”®å‘ç°ï¼š**

1. **6 ç§æ¡ä»¶åœ¨è¯­ä¹‰ç©ºé—´é‡Œå®Œç¾åˆ†ç¦»**â€”â€”UMAP å®é”¤äº†æç¤ºè¯æ¡ä»¶å†³å®šæ¿€æ´»ä½ç½®
2. **novice/expert/guru å§‹ç»ˆå­¤ç«‹**â€”â€”å®ƒä»¬çš„è¯­ä¹‰ä¿¡å·æœ¬è´¨ä¸åŒ
3. **SAE è§£ç åï¼Œstandard/padding/spaces åˆå¹¶äº†**â€”â€”SAE æŠŠå™ªéŸ³ï¼ˆç©ºæ ¼ã€åºŸè¯ï¼‰å‹ç¼©æ‰ï¼Œåªä¿ç•™è¯­ä¹‰ä¿¡å·
4. **SAE èµ·åˆ°äº†è¯­ä¹‰å»å™ªçš„ä½œç”¨**â€”â€”novice å’Œ guru åœ¨ SAE ç©ºé—´é‡Œè¢«æ¨å¾—æ›´è¿œ

| æ¡ä»¶ | åŸå§‹æ¿€æ´» | SAE ç‰¹å¾ |
|------|----------|----------|
| novice | å·¦ä¸‹è§’ï¼Œç‹¬ç«‹ | å³ä¸‹è§’ï¼Œæ›´å­¤ç«‹ |
| guru | å·¦ä¸Šè§’ï¼Œç‹¬ç«‹ | å·¦ä¸Šè§’ï¼Œæ›´å­¤ç«‹ |
| expert | ä¸­é—´ï¼Œç‹¬ç«‹ | ä¸­é—´åå·¦ï¼Œç‹¬ç«‹ |
| standard/padding/spaces | å„è‡ªæœ‰å°ç°‡ | åˆå¹¶æˆä¸€ä¸ªå¤§ç°‡ |

---

## æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `step1_extract_activations.py` | æå– Layer 50 æ¿€æ´» |
| `step2_sae_decode.py` | SAE è§£ç  |
| `step3_diff_analysis.py` | å·®å¼‚åˆ†æ |
| `step4_feature_labels.py` | decoderâ†’embedding æŠ•å½±æ–¹æ³•ï¼ˆå¼ƒç”¨ï¼Œç»“æœ noisyï¼‰ |
| `step4b_feature_context.py` | æ¿€æ´»æ ·æœ¬åˆ†æ |
| `step5_autointerp.py` | AutoInterpï¼š6 æ¡ä»¶ Ã— 50 ä¸»é¢˜çš„æ¿€æ´»åˆ†å¸ƒåˆ†æ |
| `inspect_sae.py` | SAE æ¨¡å‹ç»“æ„æ¢æµ‹ |
| `activations_layer50.pt` | åŸå§‹æ¿€æ´»æ•°æ® |
| `features_layer50.pt` | SAE feature æ•°æ® |
| `feature_diff.json` | Novice vs Expert å·®å¼‚åˆ†æ |
| `feature_context.json` | ç‰¹å¾è¯­ä¹‰åˆ†æï¼ˆNovice vs Expertï¼‰ |
| `autointerp_results.json` | AutoInterp ç»“æœï¼ˆ6 æ¡ä»¶çš„å®Œæ•´åˆ†å¸ƒï¼‰ |
| `paper_sae.md` | è‹±æ–‡è®ºæ–‡ |
| `paper_sae_zh.md` | ä¸­æ–‡è®ºæ–‡ |

---

## å‘å¸ƒè®¡åˆ’

| æ—¥æœŸ | ä¸»é¢˜ | è®ºæ–‡ç‰ˆæœ¬ | å…¬ä¼—å·è§’åº¦ | çŠ¶æ€ |
|------|------|---------|-----------|------|
| Day 1 | SAE åŸºç¡€ | v1 | "Novice æ¿€æ´»æ›´å¤šç¥ç»å…ƒ"â€”â€”ç”¨ SAE çœ‹æç¤ºè¯å·®å¼‚ | âœ… |
| Day 2 | AutoInterp | v2 | ç”¨ AutoInterp è§£ç  10 ä¸ªç‰¹å¾çš„è¯­ä¹‰ | âœ… |
| Day 3 | UMAP å¯è§†åŒ– | v3 | è¯­ä¹‰ç©ºé—´é‡Œçš„æç¤ºè¯åœ°å›¾ | âœ… |
| Day 4 | è¾“å‡ºè´¨é‡è¯„æµ‹ | v4 | DeepSeek ç›²è¯„ï¼šæ¿€æ´»æ›´å¤š = è¾“å‡ºæ›´å¥½ï¼Ÿ | ğŸ”„ è¿è¡Œä¸­ |
| Day 5 | ç»¼åˆç»“è®º | final | æ¿€æ´»æ•° vs è¾“å‡ºé•¿åº¦ vs è´¨é‡ï¼šä¸‰è§’å…³ç³» | TODO |

---

## å‚è€ƒ

- [Goodfire/Llama-3.3-70B-Instruct-SAE-l50](https://huggingface.co/Goodfire/Llama-3.3-70B-Instruct-SAE-l50)
- [goodfire-ai/r1-interpretability](https://github.com/goodfire-ai/r1-interpretability)

---

**License:** MIT
